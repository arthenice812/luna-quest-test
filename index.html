<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QUEST: –õ—É–Ω–∞ –ø—Ä–æ—Ç–∏–≤ –°–µ—Ä–æ—Å—Ç–∏</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
        
        body { margin: 0; background: #000; color: #fff; font-family: 'Montserrat', sans-serif; overflow: hidden; height: 100vh; }
        #game-container { position: relative; width: 100%; height: 100%; max-width: 500px; margin: 0 auto; background: #111; }
        
        /* –í–∏–¥–µ–æ */
        video { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 1; background: #000; }
        
        /* –ó–∞–≥–ª—É—à–∫–∞ (—Ü–≤–µ—Ç–Ω–æ–π —Ñ–æ–Ω), —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —á–µ—Ä–Ω–æ—Ç—ã */
        #fallback-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; display: flex; align-items: center; justify-content: center; text-align: center; padding: 20px; box-sizing: border-box; font-size: 1.5rem; font-weight: bold; text-shadow: 0 2px 5px rgba(0,0,0,0.5); transition: background 0.5s ease; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: flex; flex-direction: column; justify-content: flex-end; padding: 20px 40px; box-sizing: border-box; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent 60%); pointer-events: none; }
        
        /* --- –ù–û–í–´–ô –î–ò–ó–ê–ô–ù –ö–ù–û–ü–û–ö (–í–ï–ù–û–ö) --- */
        button { 
            pointer-events: auto; 
            /* –§–∏–æ–ª–µ—Ç–æ–≤–æ-—Å–µ—Ä—ã–π –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
            background: rgba(60, 50, 75, 0.85); 
            color: #fff; 
            /* –†–∞–º–∫–∞ "–ï–ª–æ–≤–∞—è –≤–µ—Ç–∫–∞" */
            border: 3px solid #2d5a27; 
            border-radius: 15px;
            padding: 15px; 
            margin: 8px 0; 
            font-weight: bold; 
            font-size: 1rem; 
            cursor: pointer; 
            text-transform: uppercase; 
            /* –°–≤–µ—á–µ–Ω–∏–µ –∫–∞–∫ –∏–≥—Ä—É—à–∫–∏ –Ω–∞ –µ–ª–∫–µ (–∫—Ä–∞—Å–Ω—ã–π –∏ –∑–æ–ª–æ—Ç–æ–π) */
            box-shadow: 0 0 5px #2d5a27, 0 0 0 1px #c0392b inset, 0 0 10px rgba(0,0,0,0.5);
            width: 100%; 
            position: relative;
            backdrop-filter: blur(5px);
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.96); background: rgba(80, 70, 95, 0.95); }
        /* –î–µ–∫–æ—Ä –∫–Ω–æ–ø–æ–∫ */
        button::before { content: 'üéÑ '; margin-right: 5px; }

        /* –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" (—á—É—Ç—å —Å–∫—Ä–æ–º–Ω–µ–µ) */
        button.back-btn { 
            background: rgba(40, 40, 40, 0.8); 
            border-color: #555; 
            box-shadow: none;
            font-size: 0.9rem;
            margin-top: 15px;
        }
        button.back-btn::before { content: '‚Ü©Ô∏è '; }

        /* –î–∏–∞–ª–æ–≥–∏ */
        .dialog-box { position: absolute; bottom: 40px; left: 20px; right: 20px; background: rgba(30, 20, 40, 0.95); border: 3px solid #ffd700; border-radius: 20px; padding: 25px; z-index: 20; text-align: center; pointer-events: auto; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
        .dialog-text { font-size: 1.1rem; margin-bottom: 20px; color: #fff; line-height: 1.4; }
        
        /* –°–≤–∏—Ç–æ–∫ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        .scroll-popup { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 50; display: flex; flex-direction: column; justify-content: center; align-items: center; animation: fadeIn 0.5s; }
        .scroll-content { background: url('https://img.freepik.com/free-photo/old-paper-texture_1194-6729.jpg') center/cover no-repeat, #fff5e6; color: #4a3b2a; padding: 40px 20px; border-radius: 5px; max-width: 80%; text-align: center; box-shadow: 0 0 50px #ffd700; transform: scale(0); animation: scaleIn 0.5s forwards; border: 8px solid #8b4513; position: relative; }
        .scroll-text { font-family: 'Georgia', serif; font-style: italic; font-size: 1.3rem; margin: 20px 0; font-weight: bold; text-shadow: 0 1px 1px rgba(255,255,255,0.5); }
        
        /* –≠–∫—Ä–∞–Ω—ã –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ */
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; background: rgba(10, 5, 20, 0.98); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 30px; box-sizing: border-box; }
        .hidden { display: none !important; }
        input { padding: 15px; border-radius: 10px; border: 2px solid #2d5a27; background: #222; color: #fff; font-size: 1.1rem; margin-bottom: 20px; width: 100%; box-sizing: border-box; text-align: center; }
        
        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        #inventory { position: absolute; top: 20px; right: 20px; z-index: 15; background: rgba(45, 90, 39, 0.8); padding: 8px 15px; border-radius: 20px; border: 2px solid #ffd700; font-weight: bold; color: #fff; display: none; box-shadow: 0 0 10px rgba(0,0,0,0.5); }

        @keyframes scaleIn { from { transform: scale(0) rotate(-10deg); } to { transform: scale(1) rotate(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="game-container">
    <div id="fallback-screen">–ó–ê–ì–†–£–ó–ö–ê...</div>
    
    <video id="vid" playsinline webkit-playsinline muted></video>
    
    <div id="inventory">üìú –°–≤–∏—Ç–æ–∫: <span id="count">0</span>/8</div>
    
    <div id="ui" class="ui-layer hidden"></div>

    <div id="dialog" class="dialog-box hidden">
        <div id="dialog-text" class="dialog-text"></div>
        <div id="dialog-buttons"></div>
    </div>

    <div id="scrollPopup" class="scroll-popup hidden">
        <div class="scroll-content">
            <h3 style="margin:0; color:#8b4513">‚ú® –°–¢–†–û–ß–ö–ê –ù–ê–ô–î–ï–ù–ê ‚ú®</h3>
            <p class="scroll-text" id="scrollLineText">...</p>
            <button onclick="closeScroll()" style="background:#8b4513; border-color:#5a2d0c; box-shadow:none;">–í –ò–ù–í–ï–ù–¢–ê–†–¨</button>
        </div>
    </div>

    <div id="loginScreen" class="overlay">
        <h1 style="color:#ffd700; text-shadow: 0 0 10px #ff0000;">üéÑ –õ–£–ù–ê v –°–ï–†–û–°–¢–¨ üéÑ</h1>
        <p>–ö–≤–µ—Å—Ç-–±—Ä–æ–¥–∏–ª–∫–∞ –ø–æ –æ—Ñ–∏—Å—É.<br>–°–æ–±–µ—Ä–∏ 8 —á–∞—Å—Ç–µ–π –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è.</p>
        <input type="text" id="username" placeholder="–¢–≤–æ–µ –∏–º—è">
        <button onclick="startGame()">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
    </div>

    <div id="winScreen" class="overlay hidden">
        <h1 style="color:#ffd700">–ü–û–ë–ï–î–ê!</h1>
        <p>–¢—ã —Å–æ–±—Ä–∞–ª(–∞) –≤—Å—ë –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ!<br>–ù–æ–≤—ã–π –≥–æ–¥ —Å–ø–∞—Å–µ–Ω!</p>
        <button onclick="location.reload()">–í –ú–ï–ù–Æ</button>
    </div>
</div>

<script>
    // --- –¢–ï–õ–ï–ì–†–ê–ú ---
    const TG_TOKEN = "8287827338:AAEaIEkNbJuk_6oFR5lEmLCQ0nObVKvpmsg"; 
    const TG_CHAT_ID = "7524680591";

    const vid = document.getElementById('vid');
    const fallback = document.getElementById('fallback-screen');
    const ui = document.getElementById('ui');
    const dialog = document.getElementById('dialog');
    let collected = new Set();
    let userName = "–ò–≥—Ä–æ–∫";

    // –°–¢–†–û–ö–ò –°–¢–ò–•–ê
    const POEM_LINES = {
        1: "–ó–∞–∂–∂—ë–º —Å–µ—Ä–¥—Ü–∞, –ø—Ä–æ–≥–æ–Ω–∏–º –ø—Ä–æ—á—å —Ç–æ—Å–∫—É,",
        2: "–ö–ª–∏–µ–Ω—Ç –¥–æ–≤–æ–ª–µ–Ω ‚Äî –º—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —á–µ–∫—É!",
        3: "–°–≤–µ–¥—ë–º –±–∞–ª–∞–Ω—Å: –∫–æ–ø–µ–π–∫–∞ –¥–æ —Ä—É–±–ª—è,",
        4: "–ò –Ω–µ –∑–∞–≤–∏—Å–Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä –Ω–∏–∫–æ–≥–¥–∞!",
        5: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è —è—Å–Ω–∞, –±—é–¥–∂–µ—Ç —Ä–∞—Å—Ç—ë—Ç,",
        6: "–ü–æ–±—å—ë–º —Ä–µ–∫–æ—Ä–¥—ã –≤ —ç—Ç–æ—Ç –ù–æ–≤—ã–π –≥–æ–¥!",
        7: "–°–∏—Å—Ç–µ–º–∞ ‚Äî –≤ –Ω–æ—Ä–º–µ, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ ‚Äî –∏–¥–µ–∞–ª,",
        8: "–ß—Ç–æ–± —á–∏—Å—Ç—ã–π –∫–æ–¥ –ø–æ–±–µ–¥—É –Ω–∞–º –∫–æ–≤–∞–ª!"
    };

    // –¢–ï–°–¢–û–í–´–ï –í–ò–î–ï–û (–ó–∞–º–µ–Ω–∏—à—å –Ω–∞ —Å–≤–æ–∏ —Ñ–∞–π–ª—ã v1_intro.mp4 –∏ —Ç.–¥.)
    const V_LOOP = "https://media.istockphoto.com/id/1363653139/video/abstract-background.mp4?s=mp4-640x640-is&k=20&c=6a_aQjQGkY3XFjF9p0yqQ1qXqQ4Q4Q4Q4Q4Q4Q4Q4Q=";
    const V_WIN = "https://media.istockphoto.com/id/1183318283/video/fireworks.mp4?s=mp4-640x640-is&k=20&c=6a_aQjQGkY3XFjF9p0yqQ1qXqQ4Q4Q4Q4Q4Q4Q4Q4Q=";

    /* –°–¶–ï–ù–ê–†–ò–ô (–õ–ò–ù–ï–ô–ù–´–ô)
       color: –¶–≤–µ—Ç –∑–∞–≥–ª—É—à–∫–∏, –ø–æ–∫–∞ –Ω–µ—Ç –≤–∏–¥–µ–æ
       next: –ö—É–¥–∞ –∏–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –≤–∏–¥–µ–æ
       btns: –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞
    */
    const scenes = {
        // --- –ü–†–û–õ–û–ì ---
        'intro': { file: V_LOOP, loop: true, color: '#111' },
        'start_walk': { file: V_LOOP, next: 'corridor_1_ou', color: '#222' },

        // --- –≠–¢–ê–ü 1: –£ –î–í–ï–†–ò –û–£ ---
        'corridor_1_ou': { 
            file: V_LOOP, loop: true, color: '#2c3e50',
            btns: [
                {t: 'üìÇ –ó–∞–π—Ç–∏ –≤ –û—Ç–¥–µ–ª –£—á–µ—Ç–∞', go: 'enter_ou'},
                {t: '–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ ‚û°Ô∏è', go: 'walk_to_sales', class: 'back-btn'}
            ]
        },

        // --- –í–ù–£–¢–†–ò –û–£ (–ú–ï–ù–Æ) ---
        'enter_ou': { file: V_LOOP, next: 'ou_hub', color: '#c0392b' },
        'ou_hub': {
            file: V_LOOP, loop: true, color: '#c0392b',
            btns: [
                {t: '‚ú® –ü–æ–¥–æ–π—Ç–∏ –∫ "–°—á–∞—Å—Ç—å—é"', act: 'talk_happy'},
                {t: 'üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –£—á–µ—Ç–∞', go: 'ou_sub_choice'},
                {t: 'üíª –ó–∞–π—Ç–∏ –≤ IT', go: 'enter_it'},
                {t: 'üíº –ó–∞–π—Ç–∏ –∫ –§–∏–Ω–î–∏—Ä—É', go: 'enter_findir'},
                {t: '–í—ã–π—Ç–∏ –≤ –∫–æ—Ä–∏–¥–æ—Ä ‚Ü©Ô∏è', go: 'exit_ou', class: 'back-btn'}
            ]
        },
        // –ü–æ–¥–º–µ–Ω—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —É—á–µ—Ç–∞ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∫—É—á–∏ –∫–Ω–æ–ø–æ–∫)
        'ou_sub_choice': {
            file: V_LOOP, loop: true, color: '#a93226',
            btns: [
                {t: 'üìÑ –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —É—á–µ—Ç', act: 'talk_general'},
                {t: 'ü§ù –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –æ—Ç–¥–µ–ª', act: 'talk_client'},
                {t: '–ù–∞–∑–∞–¥ ‚Ü©Ô∏è', go: 'ou_hub', class: 'back-btn'}
            ]
        },
        'exit_ou': { file: V_LOOP, next: 'corridor_1_ou', color: '#333' },

        // –î–ò–ê–õ–û–ì–ò –í –û–£
        'talk_happy': { vid: V_LOOP, id: 1, color: '#e74c3c' },
        'talk_client': { vid: V_LOOP, id: 2, color: '#e74c3c' },
        'talk_general': { vid: V_LOOP, id: 3, color: '#e74c3c' },

        // IT
        'enter_it': { file: V_LOOP, loop: false, nextButtons: [{t: 'üíª –ì–æ–≤–æ—Ä–∏—Ç—å —Å IT', act: 'talk_it'}, {t: '–ù–∞–∑–∞–¥', go:'ou_hub', class:'back-btn'}], color: '#27ae60' },
        'talk_it': { vid: V_LOOP, id: 4, exit: 'exit_it', color: '#2ecc71' },
        'exit_it': { file: V_LOOP, next: 'ou_hub', color: '#27ae60' },

        // FINDIR
        'enter_findir': { file: V_LOOP, loop: false, nextButtons: [{t: 'üíº –ì–æ–≤–æ—Ä–∏—Ç—å —Å –§–∏–Ω–î–∏—Ä–æ–º', act: 'talk_findir'}, {t: '–ù–∞–∑–∞–¥', go:'ou_hub', class:'back-btn'}], color: '#8e44ad' },
        'talk_findir': { vid: V_LOOP, id: 5, exit: 'exit_findir', color: '#9b59b6' },
        'exit_findir': { file: V_LOOP, next: 'ou_hub', color: '#8e44ad' },


        // --- –ü–ï–†–ï–•–û–î –ö –ü–†–û–î–ê–ñ–ê–ú ---
        'walk_to_sales': { file: V_LOOP, next: 'corridor_2_sales', color: '#444' },
        'corridor_2_sales': {
            file: V_LOOP, loop: true, color: '#d35400',
            btns: [
                {t: 'üìà –ó–∞–π—Ç–∏ –≤ –ü—Ä–æ–¥–∞–∂–∏', go: 'enter_sales'},
                {t: '–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ ‚û°Ô∏è', go: 'walk_to_getit', class: 'back-btn'},
                {t: '‚¨ÖÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –û–£', go: 'corridor_1_ou', class: 'back-btn'}
            ]
        },
        'enter_sales': { file: V_LOOP, nextButtons: [{t: 'üó£ –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å', act: 'talk_sales'}, {t: '–í—ã–π—Ç–∏', go:'exit_sales', class:'back-btn'}], color: '#e67e22' },
        'talk_sales': { vid: V_LOOP, id: 6, exit: 'exit_sales', color: '#f39c12' },
        'exit_sales': { file: V_LOOP, next: 'corridor_2_sales', color: '#d35400' },


        // --- –ü–ï–†–ï–•–û–î –ö GET IT ---
        'walk_to_getit': { file: V_LOOP, next: 'corridor_3_getit', color: '#444' },
        'corridor_3_getit': {
            file: V_LOOP, loop: true, color: '#2980b9',
            btns: [
                {t: 'üíª –ó–∞–π—Ç–∏ –≤ Get IT', go: 'enter_getit'},
                {t: '–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ ‚û°Ô∏è', go: 'walk_to_vnedr', class: 'back-btn'},
                {t: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –ü—Ä–æ–¥–∞–∂–∞–º', go: 'corridor_2_sales', class: 'back-btn'}
            ]
        },
        'enter_getit': { file: V_LOOP, nextButtons: [{t: 'üë®‚Äçüíª –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å', act: 'talk_getit'}, {t: '–í—ã–π—Ç–∏', go:'exit_getit', class:'back-btn'}], color: '#3498db' },
        'talk_getit': { vid: V_LOOP, id: 8, exit: 'exit_getit', color: '#5dade2' }, // id 8 —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –Ω–µ –ø–æ –ø–æ—Ä—è–¥–∫—É, –µ—Å–ª–∏ –Ω–∞–¥–æ
        'exit_getit': { file: V_LOOP, next: 'corridor_3_getit', color: '#2980b9' },


        // --- –ü–ï–†–ï–•–û–î –ö –í–ù–ï–î–†–ï–ù–ò–Æ ---
        'walk_to_vnedr': { file: V_LOOP, next: 'corridor_4_vnedr', color: '#444' },
        'corridor_4_vnedr': {
            file: V_LOOP, loop: true, color: '#7f8c8d',
            btns: [
                {t: 'üì¶ –ó–∞–π—Ç–∏ –≤–æ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ', go: 'enter_vnedr'},
                {t: '–ò–¥—Ç–∏ –Ω–∞ –ö—É—Ö–Ω—é ‚û°Ô∏è', go: 'walk_to_kitchen', class: 'back-btn'},
                {t: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ Get IT', go: 'corridor_3_getit', class: 'back-btn'}
            ]
        },
        'enter_vnedr': { file: V_LOOP, nextButtons: [{t: 'üì¶ –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å', act: 'talk_vnedr'}, {t: '–í—ã–π—Ç–∏', go:'exit_vnedr', class:'back-btn'}], color: '#95a5a6' },
        'talk_vnedr': { vid: V_LOOP, id: 7, exit: 'exit_vnedr', color: '#bdc3c7' },
        'exit_vnedr': { file: V_LOOP, next: 'corridor_4_vnedr', color: '#7f8c8d' },


        // --- –ü–ï–†–ï–•–û–î –ö –ö–£–•–ù–ï ---
        'walk_to_kitchen': { file: V_LOOP, next: 'corridor_5_kitchen', color: '#444' },
        'corridor_5_kitchen': {
            file: V_LOOP, loop: true, color: '#8e44ad',
            btns: [
                {t: 'üçΩÔ∏è –ó–∞–π—Ç–∏ –Ω–∞ –ö—É—Ö–Ω—é', act: 'try_kitchen'},
                {t: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –í–Ω–µ–¥—Ä–µ–Ω–∏—é', go: 'corridor_4_vnedr', class: 'back-btn'}
            ]
        },
        'kitchen_locked': { file: V_LOOP, nextButtons: [{t: '–ù—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ —Å—Ç—Ä–æ—á–∫–∏!', go: 'corridor_5_kitchen', class:'back-btn'}], color: '#000' },
        
        // –§–ò–ù–ê–õ
        'kitchen_enter': { file: V_WIN, next: 'kitchen_party', color: '#ff00ff' },
        'kitchen_party': { file: V_WIN, loop: true, btns: [{t: '‚ú® –ü–†–û–ß–ò–¢–ê–¢–¨ –ó–ê–ö–õ–ò–ù–ê–ù–ò–ï ‚ú®', go: 'final_spell'}], color: '#ff00ff' },
        'final_spell': { file: V_WIN, win: true, color: '#ffd700' }
    };

    // --- –î–í–ò–ñ–û–ö ---
    function startGame() {
        const input = document.getElementById('username');
        if (!input.value) { alert("–í–≤–µ–¥–∏ –∏–º—è!"); return; }
        userName = input.value;
        sendTg(`üöÄ <b>${userName}</b> –Ω–∞—á–∞–ª(–∞) –¢–ï–°–¢ –∏–≥—Ä—É!`);
        
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('inventory').style.display = 'block';
        playScene('intro');
        setTimeout(() => playScene('start_walk'), 1000); 
    }

    function playScene(sceneName) {
        const scene = scenes[sceneName];
        ui.innerHTML = '';
        dialog.classList.add('hidden');

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –∑–∞–≥–ª—É—à–∫–∏
        fallback.style.background = scene.color || '#333';
        fallback.innerHTML = "–°–¶–ï–ù–ê:<br>" + sceneName.toUpperCase();
        
        vid.src = scene.file || V_LOOP;
        vid.loop = scene.loop || false;
        
        vid.play().catch(e => {
            // –ï—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –∏–≥—Ä–∞–µ—Ç (—Ç–µ—Å—Ç), —ç–º—É–ª–∏—Ä—É–µ–º –≤—Ä–µ–º—è
            if (!scene.loop) setTimeout(onVideoEnd, 1500);
            else showButtons(scene);
        });

        vid.onended = onVideoEnd;

        function onVideoEnd() {
            if (scene.next) playScene(scene.next);
            if (scene.win) showWin();
            if (scene.btns || scene.nextButtons) showButtons(scene);
        }

        function showButtons(s) {
            const bList = s.btns || s.nextButtons;
            if (bList) showUI(bList);
        }
    }

    function showUI(buttons) {
        ui.innerHTML = '';
        ui.classList.remove('hidden');
        buttons.forEach(b => {
            const btn = document.createElement('button');
            btn.innerText = b.t;
            if (b.class) btn.classList.add(b.class);
            
            btn.onclick = () => {
                if (b.go) playScene(b.go);
                if (b.act === 'try_kitchen') tryKitchen();
                if (b.act && b.act.startsWith('talk')) startDialog(b.act);
            };
            ui.appendChild(btn);
        });
    }

    function startDialog(actionKey) {
        const data = scenes[actionKey]; 
        ui.classList.add('hidden'); 
        dialog.classList.remove('hidden');
        
        document.getElementById('dialog-text').innerText = "–ü—Ä–∏–≤–µ—Ç! –£ –º–µ–Ω—è –µ—Å—Ç—å —Å—Ç—Ä–æ—á–∫–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è. –î–µ—Ä–∂–∏!";
        const btnsDiv = document.getElementById('dialog-buttons');
        btnsDiv.innerHTML = '';

        const btnYes = document.createElement('button');
        btnYes.innerText = "–í–∑—è—Ç—å —Å—Ç—Ä–æ—á–∫—É";
        
        if (collected.has(data.id)) {
            btnYes.innerText = "–£–∂–µ –µ—Å—Ç—å!";
            btnYes.style.opacity = "0.5";
            btnYes.disabled = true;
        } else {
            btnYes.onclick = () => playItemVideo(data);
        }

        const btnNo = document.createElement('button');
        btnNo.innerText = "–ù–∞–∑–∞–¥";
        btnNo.classList.add('back-btn');
        btnNo.onclick = () => {
            dialog.classList.add('hidden');
            if (data.exit) playScene(data.exit); 
            else playScene('ou_hub'); // –§–æ–ª–±—ç–∫
        };

        btnsDiv.appendChild(btnYes);
        btnsDiv.appendChild(btnNo);
    }

    function playItemVideo(data) {
        dialog.classList.add('hidden');
        fallback.style.background = data.color || '#555';
        fallback.innerHTML = "–í–ò–î–ï–û:<br>–°–û–¢–†–£–î–ù–ò–ö";
        
        vid.src = data.vid || V_LOOP;
        vid.play().catch(() => setTimeout(() => showScrollPopup(data.id, data.exit || 'ou_hub'), 1500));
        vid.onended = () => showScrollPopup(data.id, data.exit || 'ou_hub');
    }

    function showScrollPopup(id, exitScene) {
        const popup = document.getElementById('scrollPopup');
        document.getElementById('scrollLineText').innerText = POEM_LINES[id];
        popup.classList.remove('hidden');
        window.currentExit = exitScene;
        
        if (!collected.has(id)) {
            collected.add(id);
            document.getElementById('count').innerText = collected.size;
            sendTg(`üìú ${userName} –Ω–∞—à–µ–ª —Å—Ç—Ä–æ—á–∫—É #${id} (${collected.size}/8)`);
        }
    }

    function closeScroll() {
        document.getElementById('scrollPopup').classList.add('hidden');
        playScene(window.currentExit);
    }

    function tryKitchen() {
        if (collected.size >= 8) playScene('kitchen_enter');
        else playScene('kitchen_locked');
    }

    function showWin() {
        document.getElementById('winScreen').classList.remove('hidden');
        sendTg(`üèÜ <b>${userName} –ü–†–û–®–ï–õ –¢–ï–°–¢ –ò–ì–†–£!</b>`);
    }

    function sendTg(text) {
        fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({chat_id: TG_CHAT_ID, text: text, parse_mode: 'HTML'})
        }).catch(err => console.log(err));
    }
</script>
</body>
</html>
