<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QUEST TEST: –õ—É–Ω–∞ –ø—Ä–æ—Ç–∏–≤ –°–µ—Ä–æ—Å—Ç–∏</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
        
        body { margin: 0; background: #000; color: #fff; font-family: 'Montserrat', sans-serif; overflow: hidden; height: 100vh; }
        #game-container { position: relative; width: 100%; height: 100%; max-width: 500px; margin: 0 auto; background: #000; }
        
        /* –í–∏–¥–µ–æ */
        video { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 1; }
        
        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: flex; flex-direction: column; justify-content: flex-end; padding: 20px; box-sizing: border-box; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent 50%); pointer-events: none; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        button { pointer-events: auto; background: rgba(255, 215, 0, 0.95); color: #000; border: 2px solid #fff; padding: 15px; margin: 5px 0; border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer; text-transform: uppercase; animation: popIn 0.3s; box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); width: 100%; }
        button:active { transform: scale(0.98); }
        button.secondary { background: rgba(255, 255, 255, 0.2); color: #fff; border: 1px solid rgba(255,255,255,0.5); }

        /* –î–∏–∞–ª–æ–≥–∏ */
        .dialog-box { position: absolute; bottom: 20px; left: 20px; right: 20px; background: rgba(0,0,0,0.9); border: 2px solid #ffd700; border-radius: 15px; padding: 20px; z-index: 20; text-align: center; pointer-events: auto; }
        .dialog-text { font-size: 1.1rem; margin-bottom: 20px; color: #fff; }
        
        /* –°–≤–∏—Ç–æ–∫ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        .scroll-popup { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 50; display: flex; flex-direction: column; justify-content: center; align-items: center; animation: fadeIn 0.5s; }
        .scroll-content { background: #fff5e6; color: #333; padding: 30px; border-radius: 5px; max-width: 80%; text-align: center; box-shadow: 0 0 50px #ffd700; transform: scale(0); animation: scaleIn 0.5s forwards; border: 4px double #8b4513; }
        .scroll-text { font-family: 'Georgia', serif; font-style: italic; font-size: 1.2rem; margin: 20px 0; font-weight: bold; }
        
        /* –≠–∫—Ä–∞–Ω—ã –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ */
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 30px; box-sizing: border-box; }
        .hidden { display: none !important; }
        input { padding: 15px; border-radius: 10px; border: 2px solid #ffd700; background: #222; color: #fff; font-size: 1.1rem; margin-bottom: 20px; width: 100%; box-sizing: border-box; text-align: center; }
        
        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        #inventory { position: absolute; top: 20px; right: 20px; z-index: 15; background: rgba(0,0,0,0.7); padding: 8px 15px; border-radius: 20px; border: 1px solid #ffd700; font-weight: bold; color: #ffd700; display: none; }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0) rotate(-10deg); } to { transform: scale(1) rotate(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="game-container">
    <video id="vid" playsinline webkit-playsinline></video>
    <div id="inventory">üìú <span id="count">0</span>/8</div>
    
    <div id="ui" class="ui-layer hidden"></div>

    <div id="dialog" class="dialog-box hidden">
        <div id="dialog-text" class="dialog-text"></div>
        <div id="dialog-buttons"></div>
    </div>

    <div id="scrollPopup" class="scroll-popup hidden">
        <div class="scroll-content">
            <h3>‚ú® –í–´ –ù–ê–®–õ–ò –°–¢–†–û–ß–ö–£! ‚ú®</h3>
            <p class="scroll-text" id="scrollLineText">...</p>
            <button onclick="closeScroll()">–£–ë–†–ê–¢–¨ –í –ò–ù–í–ï–ù–¢–ê–†–¨</button>
        </div>
    </div>

    <div id="loginScreen" class="overlay">
        <h1 style="color:#ffd700">–¢–ï–°–¢: –õ–£–ù–ê v –°–ï–†–û–°–¢–¨</h1>
        <p>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è.<br>–í–∏–¥–µ–æ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–µ.<br>–í–≤–µ–¥–∏ –∏–º—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–æ—Ç–∞:</p>
        <input type="text" id="username" placeholder="–¢–≤–æ–µ –∏–º—è...">
        <button onclick="startGame()">–ù–ê–ß–ê–¢–¨ –¢–ï–°–¢</button>
    </div>

    <div id="winScreen" class="overlay hidden">
        <h1 style="color:#ffd700">–ü–û–ë–ï–î–ê!</h1>
        <p>–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω!<br>–ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç.</p>
        <button onclick="location.reload()">–í –ú–ï–ù–Æ</button>
    </div>
</div>

<script>
    // --- –î–ê–ù–ù–´–ï –û–¢ –¢–ï–õ–ï–ì–†–ê–ú ---
    const TG_TOKEN = "8287827338:AAEaIEkNbJuk_6oFR5lEmLCQ0nObVKvpmsg"; 
    const TG_CHAT_ID = "7524680591";
    // --------------------------

    const vid = document.getElementById('vid');
    const ui = document.getElementById('ui');
    const dialog = document.getElementById('dialog');
    let collected = new Set();
    let userName = "–¢–µ—Å—Ç–µ—Ä";

    // –°–¢–†–û–ö–ò –°–¢–ò–•–ê
    const POEM_LINES = {
        1: "–ó–∞–∂–∂—ë–º —Å–µ—Ä–¥—Ü–∞, –ø—Ä–æ–≥–æ–Ω–∏–º –ø—Ä–æ—á—å —Ç–æ—Å–∫—É,",
        2: "–ö–ª–∏–µ–Ω—Ç –¥–æ–≤–æ–ª–µ–Ω ‚Äî –º—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —á–µ–∫—É!",
        3: "–°–≤–µ–¥—ë–º –±–∞–ª–∞–Ω—Å: –∫–æ–ø–µ–π–∫–∞ –¥–æ —Ä—É–±–ª—è,",
        4: "–ò –Ω–µ –∑–∞–≤–∏—Å–Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä –Ω–∏–∫–æ–≥–¥–∞!",
        5: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è —è—Å–Ω–∞, –±—é–¥–∂–µ—Ç —Ä–∞—Å—Ç—ë—Ç,",
        6: "–ü–æ–±—å—ë–º —Ä–µ–∫–æ—Ä–¥—ã –≤ —ç—Ç–æ—Ç –ù–æ–≤—ã–π –≥–æ–¥!",
        7: "–°–∏—Å—Ç–µ–º–∞ ‚Äî –≤ –Ω–æ—Ä–º–µ, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ ‚Äî –∏–¥–µ–∞–ª,",
        8: "–ß—Ç–æ–± —á–∏—Å—Ç—ã–π –∫–æ–¥ –ø–æ–±–µ–¥—É –Ω–∞–º –∫–æ–≤–∞–ª!"
    };

    // –°–°–´–õ–ö–ò –ù–ê –¢–ï–°–¢–û–í–´–ï –í–ò–î–ï–û (Pixabay)
    const V_LOOP = "https://cdn.pixabay.com/video/2019/04/23/23011-332483109_tiny.mp4"; // –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è
    const V_WALK = "https://cdn.pixabay.com/video/2020/05/25/40149-424079815_tiny.mp4"; // –•–æ–¥—å–±–∞
    const V_TALK = "https://cdn.pixabay.com/video/2022/03/13/110697-688320040_tiny.mp4"; // –î–∏–∞–ª–æ–≥
    const V_WIN = "https://cdn.pixabay.com/video/2020/02/09/32076-390435887_tiny.mp4"; // –°–∞–ª—é—Ç

    // –°–¶–ï–ù–ê–†–ò–ô (–¢–ï–°–¢)
    const scenes = {
        'intro': { file: V_LOOP, loop: true },
        'start_walk': { file: V_WALK, next: 'corridor' },
        'corridor': { 
            file: V_LOOP, loop: true,
            btns: [
                {t: 'üìÇ –û—Ç–¥–µ–ª –£—á–µ—Ç–∞', go: 'enter_ou'},
                {t: 'üìà –ü—Ä–æ–¥–∞–∂–∏', go: 'enter_sales'},
                {t: 'üì¶ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ', go: 'enter_vnedr'},
                {t: 'üíª Get IT', go: 'enter_getit'},
                {t: 'üçΩÔ∏è –ö—É—Ö–Ω—è (–§–∏–Ω–∞–ª)', act: 'try_kitchen'}
            ]
        },
        
        // --- –û–¢–î–ï–õ –£–ß–ï–¢–ê ---
        'enter_ou': { file: V_WALK, next: 'ou_hub' },
        'ou_hub': {
            file: V_LOOP, loop: true,
            btns: [
                {t: '‚ú® –ü–æ–¥–æ–π—Ç–∏ –∫ "–°—á–∞—Å—Ç—å—é"', act: 'talk_happy'},
                {t: 'ü§ù –ü–æ–¥–æ–π—Ç–∏ –∫ –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–º—É', act: 'talk_client'},
                {t: 'üìë –ü–æ–¥–æ–π—Ç–∏ –∫ –û–±—â–µ–º—É', act: 'talk_general'},
                {t: 'üö™ –ó–∞–π—Ç–∏ –≤ IT', go: 'enter_it'},
                {t: 'üíº –ó–∞–π—Ç–∏ –∫ –§–∏–Ω–î–∏—Ä—É', go: 'enter_findir'},
                {t: 'üîô –í –∫–æ—Ä–∏–¥–æ—Ä', go: 'exit_ou'}
            ]
        },
        'exit_ou': { file: V_WALK, next: 'corridor' },

        // –î–ò–ê–õ–û–ì–ò –í –û–£
        'talk_happy': { vid: V_TALK, id: 1 },
        'talk_client': { vid: V_TALK, id: 2 },
        'talk_general': { vid: V_TALK, id: 3 },

        // IT
        'enter_it': { file: V_WALK, loop: false, nextButtons: [{t: 'üíª –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å IT', act: 'talk_it'}] },
        'talk_it': { vid: V_TALK, id: 4, exit: 'exit_it' },
        'exit_it': { file: V_WALK, next: 'ou_hub' },

        // FINDIR
        'enter_findir': { file: V_WALK, loop: false, nextButtons: [{t: 'üíº –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –§–∏–Ω–î–∏—Ä–æ–º', act: 'talk_findir'}] },
        'talk_findir': { vid: V_TALK, id: 5, exit: 'exit_findir' },
        'exit_findir': { file: V_WALK, next: 'ou_hub' },

        // --- –î–†–£–ì–ò–ï –û–¢–î–ï–õ–´ ---
        'enter_sales': { file: V_WALK, nextButtons: [{t: 'üó£ –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –ü—Ä–æ–¥–∞–∂–∞–º–∏', act: 'talk_sales'}] },
        'talk_sales': { vid: V_TALK, id: 6, exit: 'exit_sales' },
        'exit_sales': { file: V_WALK, next: 'corridor' },

        'enter_vnedr': { file: V_WALK, nextButtons: [{t: 'üì¶ –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –í–Ω–µ–¥—Ä–µ–Ω–∏–µ–º', act: 'talk_vnedr'}] },
        'talk_vnedr': { vid: V_TALK, id: 7, exit: 'exit_vnedr' },
        'exit_vnedr': { file: V_WALK, next: 'corridor' },

        'enter_getit': { file: V_WALK, nextButtons: [{t: 'üë®‚Äçüíª –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –†–∞–∑—Ä–∞–±–æ–º', act: 'talk_getit'}] },
        'talk_getit': { vid: V_TALK, id: 8, exit: 'exit_getit' },
        'exit_getit': { file: V_WALK, next: 'corridor' },

        // --- –ö–£–•–ù–Ø ---
        'kitchen_locked': { file: V_LOOP, nextButtons: [{t: '–ù—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ!', go: 'corridor'}] },
        'kitchen_enter': { file: V_WIN, next: 'kitchen_party' },
        'kitchen_party': { 
            file: V_WIN, loop: true,
            btns: [{t: '‚ú® –ü–†–û–ß–ò–¢–ê–¢–¨ –ó–ê–ö–õ–ò–ù–ê–ù–ò–ï ‚ú®', go: 'final_spell'}]
        },
        'final_spell': { file: V_WIN, win: true }
    };

    // --- –î–í–ò–ñ–û–ö ---

    function startGame() {
        const input = document.getElementById('username');
        if (!input.value) { alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!"); return; }
        userName = input.value;
        sendTg(`üöÄ <b>${userName}</b> –Ω–∞—á–∞–ª(–∞) –¢–ï–°–¢ –∏–≥—Ä—É!`);
        
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('inventory').style.display = 'block';
        
        playScene('intro');
        // –≠–º—É–ª—è—Ü–∏—è: —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –ø–µ—Ä–µ—Ö–æ–¥ –∫ "–æ—Ç–∫—Ä—ã—Ç–∏—é –ª–∏—Ñ—Ç–∞"
        setTimeout(() => playScene('start_walk'), 1000); 
    }

    function playScene(sceneName) {
        const scene = scenes[sceneName];
        ui.innerHTML = '';
        dialog.classList.add('hidden');
        
        vid.src = scene.file;
        vid.loop = scene.loop || false;
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤)
        vid.play().catch(e => console.log("–ù—É–∂–µ–Ω –∫–ª–∏–∫ –¥–ª—è –∞–≤—Ç–æ–ø–ª–µ—è"));

        vid.onended = () => {
            if (scene.next) playScene(scene.next);
            if (scene.win) showWin();
            if (scene.btns || scene.nextButtons) showUI(scene.btns || scene.nextButtons);
        };

        if (scene.loop && (scene.btns || scene.nextButtons)) {
            showUI(scene.btns || scene.nextButtons);
        }
    }

    function showUI(buttons) {
        ui.innerHTML = '';
        ui.classList.remove('hidden');
        buttons.forEach(b => {
            const btn = document.createElement('button');
            btn.innerText = b.t;
            btn.onclick = () => {
                if (b.go) playScene(b.go);
                if (b.act === 'try_kitchen') tryKitchen();
                if (b.act && b.act.startsWith('talk')) startDialog(b.act);
            };
            ui.appendChild(btn);
        });
    }

    function startDialog(actionKey) {
        const data = scenes[actionKey]; 
        ui.classList.add('hidden'); 
        
        dialog.classList.remove('hidden');
        const dialogText = document.getElementById('dialog-text');
        const dialogBtns = document.getElementById('dialog-buttons');
        
        dialogText.innerText = "–ü—Ä–∏–≤–µ—Ç! –Ø —Å–æ–±–∏—Ä–∞—é —Å—Ç—Ä–æ—á–∫–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è. –£ —Ç–µ–±—è –µ—Å—Ç—å —á—Ç–æ-—Ç–æ –¥–ª—è –º–µ–Ω—è?";
        dialogBtns.innerHTML = '';

        const btnYes = document.createElement('button');
        btnYes.innerText = "–î–∞, –µ—Å—Ç—å! (–í–∑—è—Ç—å)";
        
        if (collected.has(data.id)) {
            btnYes.innerText = "‚ùå –¢—ã —É–∂–µ –∑–∞–±—Ä–∞–ª(–∞) —ç—Ç—É —Å—Ç—Ä–æ—á–∫—É!";
            btnYes.classList.add('secondary');
            btnYes.disabled = true;
        } else {
            btnYes.onclick = () => playItemVideo(data);
        }

        const btnNo = document.createElement('button');
        btnNo.innerText = "–ù–µ—Ç, —Å–ø–∞—Å–∏–±–æ (–£–π—Ç–∏)";
        btnNo.classList.add('secondary');
        btnNo.onclick = () => {
            dialog.classList.add('hidden');
            if (data.exit) playScene(data.exit); 
            else playScene('ou_hub');
        };

        dialogBtns.appendChild(btnYes);
        dialogBtns.appendChild(btnNo);
    }

    function playItemVideo(data) {
        dialog.classList.add('hidden');
        vid.src = data.vid;
        vid.loop = false;
        vid.play();
        
        vid.onended = () => {
            showScrollPopup(data.id, data.exit || 'ou_hub');
        };
    }

    function showScrollPopup(id, exitScene) {
        const popup = document.getElementById('scrollPopup');
        const text = document.getElementById('scrollLineText');
        
        text.innerText = POEM_LINES[id];
        popup.classList.remove('hidden');
        window.currentExit = exitScene;
        
        if (!collected.has(id)) {
            collected.add(id);
            document.getElementById('count').innerText = collected.size;
            sendTg(`üìú ${userName} –Ω–∞—à–µ–ª —Å—Ç—Ä–æ—á–∫—É #${id} (${collected.size}/8)`);
        }
    }

    function closeScroll() {
        document.getElementById('scrollPopup').classList.add('hidden');
        playScene(window.currentExit);
    }

    function tryKitchen() {
        if (collected.size >= 8) playScene('kitchen_enter');
        else playScene('kitchen_locked');
    }

    function showWin() {
        document.getElementById('winScreen').classList.remove('hidden');
        sendTg(`üèÜ <b>${userName} –ü–†–û–®–ï–õ –¢–ï–°–¢ –ò–ì–†–£!</b>`);
    }

    function sendTg(text) {
        fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({chat_id: TG_CHAT_ID, text: text, parse_mode: 'HTML'})
        }).catch(err => console.log(err));
    }

</script>
</body>
</html>
